.psx
.Open "!SLPS017.83", "SLPS017.83", 0x8000F800

.orga 0x000252c0
		j 0x8000B2F0
		
.orga 0x00000280
		lbu     $v0, 0x64($s0)		; load last charWidth
		lhu     $v1, 0x60($s0)		; xPosition
		lw      $a0, 0x54($s0)		; strPosition
		sb      $zero, 0x64($s0)	; clear charWidth
		addu    $v1, $v0			; xPosition += charWidth
		sh      $v1, 0x60($s0)		; save xPosition
		
		lbu     $s2, 0($a0)			; load firstChar
		nop							;
		
		andi    $v0, $s2, 0x80		; if (firstChar < 0x80) then read secondChar
		beqz    $v0, @@readCharFromTable			
		
		sll     $v0, $s2, 8			; firstChar << 8
		lbu     $v1, 1($a0)			; load secondChar
		j       0x80034B24			; skip readCharFromTable
		or      $s1, $v0, $v1		;
		
@@readCharFromTable:
		;lw      $v0, 8($s3) 		; mdtDataPtr
		;nop							;
		;lw      $v1, 0($v0)			; load mdtDataPosition
		;sll     $v0, $s2, 1			; charIndex * sizeof(char) [0x02]
		;addiu   $v0, 8				; charOffset + sizeof(mdtHeader)
		;addu    $v1, $v0			; offset = mdtDataPosition + charOffset
		;lhu     $s1, 0($v1)			; load char from table
		;nop							;
		;srl     $v1, $s1, 8			; swap bytes
		;sll     $v0, $s1, 8			;
		;or      $s1, $v0, $v1		;
		
		li 		$v0, 0x8000B0F0		; load charTable offset
		sll		$v1, $s2, 2			; charIndex * sizeof(charEntry)
		addu	$v0, $v1			; get charOffset
		
		lbu 	$v1, 2($v0)			; load charWidth
		nop
		sb		$v1, 0x92($s0)		; save charWidth
		
		lhu     $s1, 0($v0)			; load char from table
		nop							;
		srl     $v1, $s1, 8			; swap bytes
		sll     $v0, $s1, 8			;
		j		0x80034B24			;
		or      $s1, $v0, $v1		;
		
; ==== Char Table ====
; Char Table
; Format: 1, 2 - char, 3 - width, 4 - height
.orga 0x00000080 ; Char Table 0x8000B0F0
	.db 0xFF, 0xFF, 0x0E, 0x10 ; 0x00 NUL
	.db 0x00, 0x01, 0x0E, 0x10 ; 0x01 SOH
	.db 0x00, 0x02, 0x0E, 0x10 ; 0x02 STX
	.db 0x00, 0x03, 0x0E, 0x10 ; 0x03 ETX
	.db 0x00, 0x04, 0x0E, 0x10 ; 0x04 EOT
	.db 0x00, 0x05, 0x0E, 0x10 ; 0x05 ENQ
	.db 0x00, 0x06, 0x0E, 0x10 ; 0x06 ACK
	.db 0x00, 0x07, 0x0E, 0x10 ; 0x07 BEL
	.db 0x00, 0x08, 0x0E, 0x10 ; 0x08 BS
	.db 0x00, 0x09, 0x0E, 0x10 ; 0x09 TAB
	.db 0xFF, 0x6E, 0x0E, 0x10 ; 0x0A LF
	.db 0x00, 0x0B, 0x0E, 0x10 ; 0x0B VT
	.db 0x00, 0x0C, 0x0E, 0x10 ; 0x0C FF
	.db 0x00, 0x0D, 0x0E, 0x10 ; 0x0D CR
	.db 0x00, 0x0E, 0x0E, 0x10 ; 0x0E SO
	.db 0x00, 0x0F, 0x0E, 0x10 ; 0x0F SI
	
	.db 0x81, 0x96, 0x0E, 0x10 ; 0x10 DLE
	.db 0x81, 0xA2, 0x0E, 0x10 ; 0x11 DC1
	.db 0x81, 0x9B, 0x0E, 0x10 ; 0x12 DC2
	.db 0x00, 0x13, 0x0E, 0x10 ; 0x13 DC3
	.db 0x81, 0xA0, 0x0E, 0x10 ; 0x14 DC4
	.db 0x00, 0x15, 0x0E, 0x10 ; 0x15 NAK
	.db 0x00, 0x16, 0x0E, 0x10 ; 0x16 SYN
	.db 0x00, 0x17, 0x0E, 0x10 ; 0x17 ETB
	.db 0x00, 0x18, 0x0E, 0x10 ; 0x18 CAN
	.db 0x00, 0x19, 0x0E, 0x10 ; 0x19 EM
	.db 0x00, 0x1A, 0x0E, 0x10 ; 0x1A SUB
	.db 0x00, 0x1B, 0x0E, 0x10 ; 0x1B ESC
	.db 0x00, 0x1C, 0x0E, 0x10 ; 0x1C FS
	.db 0x00, 0x1D, 0x0E, 0x10 ; 0x1D GS
	.db 0x00, 0x1E, 0x0E, 0x10 ; 0x1E RS
	.db 0x00, 0x1F, 0x0E, 0x10 ; 0x1F US

	.db 0xA0, 0x00, 0x08, 0x10 ; 0x20  
	.db 0x81, 0x49, 0x06, 0x10 ; 0x21 !
	.db 0x81, 0x8D, 0x0E, 0x10 ; 0x22 "
	.db 0x81, 0x94, 0x0E, 0x10 ; 0x23 #
	.db 0x81, 0x90, 0x0E, 0x10 ; 0x24 $
	.db 0x81, 0x93, 0x1E, 0x10 ; 0x25 %
	.db 0x81, 0x95, 0x0E, 0x10 ; 0x26 &
	.db 0x81, 0x8C, 0x04, 0x10 ; 0x27 '
	.db 0x81, 0x69, 0x0E, 0x10 ; 0x28 (
	.db 0x81, 0x6A, 0x0E, 0x10 ; 0x29 )
	.db 0x81, 0x7E, 0x0E, 0x10 ; 0x2A *
	.db 0x81, 0x7B, 0x0E, 0x10 ; 0x2B +
	.db 0x81, 0x43, 0x06, 0x10 ; 0x2C ,
	.db 0x81, 0x7C, 0x0E, 0x10 ; 0x2D -
	.db 0x81, 0x44, 0x06, 0x10 ; 0x2E .
	.db 0x81, 0x5E, 0x0E, 0x10 ; 0x2F /
	
	.db 0x82, 0x4F, 0x0E, 0x10 ; 0x30 0
	.db 0x82, 0x50, 0x0E, 0x10 ; 0x31 1
	.db 0x82, 0x51, 0x0E, 0x10 ; 0x32 2
	.db 0x82, 0x52, 0x0E, 0x10 ; 0x33 3
	.db 0x82, 0x53, 0x0E, 0x10 ; 0x34 4
	.db 0x82, 0x54, 0x0E, 0x10 ; 0x35 5
	.db 0x82, 0x55, 0x0E, 0x10 ; 0x36 6
	.db 0x82, 0x56, 0x0E, 0x10 ; 0x37 7
	.db 0x82, 0x57, 0x0E, 0x10 ; 0x38 8
	.db 0x82, 0x58, 0x0E, 0x10 ; 0x39 9
	.db 0x81, 0x46, 0x0E, 0x10 ; 0x3A :
	.db 0x81, 0x47, 0x0E, 0x10 ; 0x3B ;
	.db 0x81, 0x83, 0x0E, 0x10 ; 0x3C <
	.db 0x81, 0x81, 0x0E, 0x10 ; 0x3D =
	.db 0x81, 0x84, 0x0E, 0x10 ; 0x3E >
	.db 0x81, 0x48, 0x0E, 0x10 ; 0x3F ?

	.db 0x81, 0x97, 0x0E, 0x10 ; 0x40 @
	.db 0x82, 0x60, 0x0C, 0x10 ; 0x41 A
	.db 0x82, 0x61, 0x0C, 0x10 ; 0x42 B
	.db 0x82, 0x62, 0x0C, 0x10 ; 0x43 C
	.db 0x82, 0x63, 0x0C, 0x10 ; 0x44 D
	.db 0x82, 0x64, 0x0C, 0x10 ; 0x45 E
	.db 0x82, 0x65, 0x0C, 0x10 ; 0x46 F
	.db 0x82, 0x66, 0x0C, 0x10 ; 0x47 G
	.db 0x82, 0x67, 0x0C, 0x10 ; 0x48 H
	.db 0x82, 0x68, 0x0C, 0x10 ; 0x49 I
	.db 0x82, 0x69, 0x0C, 0x10 ; 0x4A J
	.db 0x82, 0x6A, 0x0C, 0x10 ; 0x4B K
	.db 0x82, 0x6B, 0x0C, 0x10 ; 0x4C L
	.db 0x82, 0x6C, 0x0C, 0x10 ; 0x4D M
	.db 0x82, 0x6D, 0x0C, 0x10 ; 0x4E N
	.db 0x82, 0x6E, 0x0C, 0x10 ; 0x4F O

	.db 0x82, 0x6F, 0x0C, 0x10 ; 0x50 P
	.db 0x82, 0x70, 0x0C, 0x10 ; 0x51 Q
	.db 0x82, 0x71, 0x0C, 0x10 ; 0x52 R
	.db 0x82, 0x72, 0x0C, 0x10 ; 0x53 S
	.db 0x82, 0x73, 0x0C, 0x10 ; 0x54 T
	.db 0x82, 0x74, 0x0C, 0x10 ; 0x55 U
	.db 0x82, 0x75, 0x0C, 0x10 ; 0x56 V
	.db 0x82, 0x76, 0x0C, 0x10 ; 0x57 W
	.db 0x82, 0x77, 0x0C, 0x10 ; 0x58 X
	.db 0x82, 0x78, 0x0C, 0x10 ; 0x59 Y
	.db 0x82, 0x79, 0x0C, 0x10 ; 0x5A Z
	.db 0x81, 0x6D, 0x0E, 0x10 ; 0x5B [
	.db 0x81, 0x5F, 0x0E, 0x10 ; 0x5C (LEFT SEP)
	.db 0x81, 0x6E, 0x0E, 0x10 ; 0x5D ]
	.db 0x81, 0x4F, 0x0E, 0x10 ; 0x5E ^
	.db 0x81, 0x51, 0x0E, 0x10 ; 0x5F _
	
	.db 0x81, 0x4D, 0x0E, 0x10 ; 0x60 `
	.db 0x82, 0x81, 0x0C, 0x10 ; 0x61 a
	.db 0x82, 0x82, 0x0C, 0x10 ; 0x62 b
	.db 0x82, 0x83, 0x0C, 0x10 ; 0x63 c
	.db 0x82, 0x84, 0x0C, 0x10 ; 0x64 d
	.db 0x82, 0x85, 0x0C, 0x10 ; 0x65 e
	.db 0x82, 0x86, 0x0C, 0x10 ; 0x66 f
	.db 0x82, 0x87, 0x0C, 0x10 ; 0x67 g
	.db 0x82, 0x88, 0x0C, 0x10 ; 0x68 h
	.db 0x82, 0x89, 0x0C, 0x10 ; 0x69 i
	.db 0x82, 0x8A, 0x0C, 0x10 ; 0x6A j
	.db 0x82, 0x8B, 0x0C, 0x10 ; 0x6B k
	.db 0x82, 0x8C, 0x0C, 0x10 ; 0x6C l
	.db 0x82, 0x8D, 0x0C, 0x10 ; 0x6D m
	.db 0x82, 0x8E, 0x0C, 0x10 ; 0x6E n
	.db 0x82, 0x8F, 0x0C, 0x10 ; 0x6F o
	
	.db 0x82, 0x90, 0x0C, 0x10 ; 0x70 p
	.db 0x82, 0x91, 0x0C, 0x10 ; 0x71 q
	.db 0x82, 0x92, 0x0C, 0x10 ; 0x72 r
	.db 0x82, 0x93, 0x0C, 0x10 ; 0x73 s
	.db 0x82, 0x94, 0x0C, 0x10 ; 0x74 t
	.db 0x82, 0x95, 0x0C, 0x10 ; 0x75 u
	.db 0x82, 0x96, 0x0C, 0x10 ; 0x76 v
	.db 0x82, 0x97, 0x0C, 0x10 ; 0x77 w
	.db 0x82, 0x98, 0x0C, 0x10 ; 0x78 x
	.db 0x82, 0x99, 0x0C, 0x10 ; 0x79 y
	.db 0x82, 0x9A, 0x0C, 0x10 ; 0x7A z
	.db 0x81, 0x6F, 0x0E, 0x10 ; 0x7B {
	.db 0x81, 0x62, 0x0E, 0x10 ; 0x7C |
	.db 0x81, 0x70, 0x0E, 0x10 ; 0x7D }
	.db 0x81, 0x60, 0x0E, 0x10 ; 0x7E `
	.db 0x00, 0x7F, 0x0E, 0x10 ; 0x7F DEL
	
.Close